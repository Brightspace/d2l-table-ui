<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<!--
# D2L Scroll Wrapper

## Usage
```
	<link rel="import" href="d2l-scroll-wrapper.html">
	<style>
		#scroll-wrapper {
			--d2l-scroll-wrapper-h-scroll: {
				/* styles to apply when horizontal scrollbar appears */
			}

			/* Note that the left/right styles are applied at the same time if there is no scrollbar */
			--d2l-scroll-wrapper-left: {
				/* styles to apply when scrolled to the left */
			}
			--d2l-scroll-wrapper-right: {
				/* styles to apply when scrolled to the right */
			}
		}
	</style>
	<d2l-scroll-wrapper id="scroll-wrapper">
		<div>Stuff</div>
	</d2l-scroll-wrapper>
```
-->
<dom-module id="d2l-scroll-wrapper">
	<template strip-whitespace>
		<style>
			:host {
				display: block;
				overflow: auto;
				width: 100%;
				box-sizing: border-box;
			}

			:host([h-scrollbar]),
			:host-context([dir="rtl"])[scroll-rtl-reverse] {
				@apply(--d2l-scroll-wrapper-h-scroll);
			}

			:host-context([dir="rtl"])[scroll-rtl-reverse][scrollbar-right],
			:host([scrollbar-left]) {
				@apply(--d2l-scroll-wrapper-left);
			}

			:host-context([dir="rtl"])[scroll-rtl-reverse][scrollbar-left],
			:host([scrollbar-right]) {
				@apply(--d2l-scroll-wrapper-right);
			}
		</style>
		<content></content>
	</template>
	<script>
		function getScrollType() {
			var type = 'reverse';
			var div = document.createElement('div');
			div.innerHTML = '<div dir="rtl" style="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll">A</div>';
			var definer = div.firstChild;
			document.body.appendChild(div);
			if (definer.scrollLeft > 0) {
				type = 'default';
			} else {
				definer.scrollLeft = 1;
				if (definer.scrollLeft === 0) {
					type = 'negative';
				}
			}
			document.body.removeChild(div);
			return type;
		}
		var type;
		Polymer({
			is: 'd2l-scroll-wrapper',
			behaviors: [Polymer.IronResizableBehavior],

			properties: {
				/** Whether this element has a horizontal scrollbar */
				hScrollbar: {
					type: Boolean,
					reflectToAttribute: true,
					value: false,
					readOnly: true
				},
				/** Whether this element is scrolled to the left */
				scrollbarLeft: {
					type: Boolean,
					reflectToAttribute: true,
					value: false,
					readOnly: true
				},
				/** Whether this element is scrolled to the right */
				scrollbarRight: {
					type: Boolean,
					reflectToAttribute: true,
					value: false,
					readOnly: true
				},
				scrollRtlReverse: {
					type: Boolean,
					reflectToAttribute: true,
					value: false,
					readOnly: true
				}
			},

			listeners: {
				'iron-resize': 'checkScrollbar',
				'scroll': 'checkScrollThresholds'
			},

			ready: function() {
				if (!type) {
					type = getScrollType();
				}
				this._setScrollRtlReverse(type !== 'default');
			},

			attached: function() {
				this.async(this.checkScrollbar);
			},

			checkScrollbar: function() {
				this._setHScrollbar(this.offsetWidth !== this.scrollWidth);
				this.checkScrollThresholds();
			},

			checkScrollThresholds: function() {
				var lowerScrollValue = this.scrollWidth - this.offsetWidth - Math.abs(this.scrollLeft);
				this._setScrollbarLeft(this.scrollLeft === 0);
				this._setScrollbarRight(lowerScrollValue <= 0);
			}
		});
	</script>
</dom-module>
