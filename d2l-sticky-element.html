<link rel="import" href="../polymer/polymer.html">

<!--
    Copied with modifications and fixes from https://github.com/seaneking/sticky-element/blob/master/sticky-element.html
-->

<script src="../stickyfill/dist/stickyfill.min.js"></script>
<dom-module id="d2l-sticky-element">
	<template strip-whitespace>
		<style>
			:host {
				position: -webkit-sticky;
				position: sticky;
				top: 0;
				z-index: 4;
				line-height: 0;
			}
		</style>
		<slot></slot>
	</template>
	<script>
		/* global Stickyfill */
		Polymer({
			is: 'd2l-sticky-element',
			properties: {
				disabled: {
					type: Boolean,
					observer: '_disabledChanged'
				}
			},
			detached: function() {
				try {
					this._ensureStickyRemoved();
				} catch (e) {
					return;
				}
			},
			_ensureStickyAdded: function() {
				if (this._sticky) return;
				this._sticky = Stickyfill.addOne(this);
			},
			_ensureStickyRemoved: function() {
				if (!this._sticky) return;
				// If remove fails, still unset _sticky.
				var tmp = this._sticky;
				this._sticky = null;
				tmp.remove();
			},
			_updateSticky: function() {
				/**
				 * Stickyfill requires the component to be attached to the DOM
				 * in order to work. If the component is not attached, the attached
				 * method will handle initialization
				 */
				if (!this.isAttached) {
					return;
				}
				var sticky = !this.disabled;
				try {
					if (sticky) {
						this._ensureStickyAdded();
					} else {
						this._ensureStickyRemoved();
					}
				} catch (e) {
					return;
				}
			},
			_disabledChanged: function() {
				// Defer the getComputedStyle() calls until after the page has rendered
				Polymer.RenderStatus.afterNextRender(this, this._updateSticky);
			}
		});
	</script>
</dom-module>
