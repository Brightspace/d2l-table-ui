<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="d2l-table-style.html">
<link rel="import" href="d2l-scroll-wrapper.html">
<link rel="import" href="d2l-table-col-sort.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">

<!--
# D2L Table

## Usage
```
	<link rel="import" href="d2l-table.html">
	<table is="d2l-table">
		<thead>
			<tr>
				<th>Table header cell</th>
			</tr>
		</thead>
		<tfoot>
			<tr>
				<th>Table header cell</th>
			</tr>
		</tfoot>
		<tbody>
			<tr>
				<td>Table cell</td>
			</tr>
		</tbody>
	</table>
```

## Wrapped Table

Since only tr,tbody,thead,tfoot,caption,colgroup,etc can be found in a table,
templating the wrapper is tricky. We need to trick the browser into allowing
a content element inside the table (which Polymer's shady DOM will replace with
the valid table content, and the shadow DOM will be valid)

To keep the final markup valid, the content is wrapped in a `<tr><td></td></tr>`.

Markup
```
	<table is="d2l-table">
		<thead>
			<tr>
				<th>Table header cell</th>
			</tr>
		</thead>
		<tfoot>
			<tr>
				<th>Table header cell</th>
			</tr>
		</tfoot>
		<tbody>
			<tr>
				<td>Table cell</td>
			</tr>
		</tbody>
	</table>
```

Composed DOM looks something like this:
```
	<table is="d2l-table" role="presentation">
		<tr role="presentation"><td role="presentation"><div class="wrapper-stuff"><table id="wrapped">
			<thead>
				<tr>
					<th>Table header cell</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<th>Table header cell</th>
				</tr>
			</tfoot>
			<tbody>
				<tr>
					<td>Table cell</td>
				</tr>
			</tbody>
		</table></div></td></tr>
	</table>
```
## TODO

When ShadowDOM v1 is available, use `<slot>` and `::slotted`. This may affect the interface

@demo demo/index.html      Table demo
@demo demo/index.rtl.html  RTL Table demo
@demo demo/responsive.html Identical tables with different widths
-->
<dom-module id="d2l-table">
	<template>
		<style include="d2l-table-style d2l-colors">
			:host {
				--d2l-table-border-color: var(--d2l-color-titanius);
				--d2l-table-border: 1px solid var(--d2l-table-border-color);
				--d2l-table-border-radius: 0.3rem;
				--d2l-table-header-background-color: var(--d2l-color-regolith);
				--d2l-table-body-background-color: #fff;
				--d2l-table-row-background-color-active: var(--d2l-color-celestine-light-1);
				--d2l-table-row-border-color-active-selected: var(--d2l-color-celestine-light-2);
				--d2l-table-row-background-color-active-selected: #EBF5FC;
				--d2l-table-row-border-color-selected: var(--d2l-color-celestine-light-2);
				--d2l-table-row-background-color-selected: var(--d2l-color-celestine-light-1);
				--d2l-table-border-overflow: dashed 1px #d3d9e3;
			}

			tr, td, :host {
				display: block;
				margin: 0;
				padding: 0;
			}

			d2l-scroll-wrapper {
				border-left: var(--d2l-table-border-overflow);
				border-right: var(--d2l-table-border-overflow);
			}

			d2l-scroll-wrapper[scrollbar-left] {
				border-left: none;
			}

			d2l-scroll-wrapper[scrollbar-right] {
				border-right: none;
			}
		</style>
		<!--
			The ready method will put everything in this template into a
		    <tr><td></td></tr>, so the template content is free of table restrictions
		 -->
		<template id="wrapperTemplate">
			<d2l-scroll-wrapper>
				<!--
					<content> can't be placed inside a <table> in the markup,
					so the ready method does this for us
				-->
				<table id="wrapped"></table>
			</d2l-scroll-wrapper>
		</template>
	</template>
	<script>
		Polymer({
			is: 'd2l-table',
			extends: 'table',
			created: function() {
				// So that screenreaders only read the wrapped table
				this.setAttribute('role', 'presentation');
			},
			// Wrap #wrapperTemplate in a presentational <tr><td></td></tr> and put <content> in #wrapped
			ready: function() {
				var content = document.createElement('content');
				var wrapperTemplate = document.importNode(this.$.wrapperTemplate._content, true);
				var wrapped = wrapperTemplate.querySelector('#wrapped');
				var tr = document.createElement('tr');
				var td = document.createElement('td');

				tr.setAttribute('role', 'presentation');
				td.setAttribute('role', 'presentation');

				Polymer.dom(this.root).appendChild(tr);
				Polymer.dom(tr).appendChild(td);
				Polymer.dom(td).appendChild(wrapperTemplate);
				Polymer.dom(wrapped).appendChild(content);
				Polymer.dom.flush();
			}
		});
	</script>
</dom-module>
